# 📥 دليل استيراد البيانات من Excel

## ✅ نعم! النظام يدعم استيراد البيانات من Excel بطريقتين

---

## 🌟 الطريقة 1: عبر واجهة المستخدم (الأسهل)

### 📍 الخطوات:

#### 1️⃣ **افتح صفحة استيراد البيانات**

**للوصول إلى الصفحة:**
- افتح المتصفح على: `http://localhost:9002/import-data`
- أو من القائمة الجانبية: **إدارة البيانات** → **استيراد البيانات**

#### 2️⃣ **اختر نوع البيانات المراد استيرادها**

النظام يدعم استيراد:

| النوع | الوصف | الأعمدة المطلوبة |
|------|-------|------------------|
| 🏧 **ماكينات ATM** | بيانات الماكينات | `ATM Code`, `Serial`, `Model`, `Bank`, `Governorate`, `City`, `Address` |
| 👥 **المندوبين** | بيانات المندوبين | `Name`, `Username`, `Email` |
| 🏦 **البنوك** | بيانات البنوك | `Name`, `Location`, `Contact` |
| 🗺️ **المحافظات** | بيانات المحافظات | `Name`, `Code` |

#### 3️⃣ **تحميل قالب Excel**

- اضغط على زر **"تحميل القالب"** (Download Template)
- سيتم تحميل ملف CSV يحتوي على الأعمدة المطلوبة
- املأ البيانات في الملف

#### 4️⃣ **رفع الملف**

- اضغط على زر **"اختيار ملف"** (Choose File)
- اختر ملف CSV أو Excel الذي ملأته
- اضغط على زر **"استيراد البيانات"** (Import Data)

#### 5️⃣ **انتظر النتائج**

سترى تقرير مفصل يحتوي على:
- ✅ عدد السجلات الناجحة
- ⚠️ عدد السجلات المتخطاة
- ❌ عدد السجلات الفاشلة
- 📋 تفاصيل الأخطاء (إن وجدت)

---

## 🖥️ الطريقة 2: عبر سطر الأوامر

### 📍 الخطوات:

#### 1️⃣ **تحضير ملف Excel**

أنشئ ملف Excel بهذا التنسيق:

**مثال لملف ماكينات ATM:**

| ATM Code | Serial | Model | Bank | Governorate | City | Address |
|----------|--------|-------|------|-------------|------|---------|
| ATM9333 | GEUT0064262 | 6632 PERSONAS77 | البنك الأهلي المصري | القاهرة | القاهرة الجديدة | فرع بنك تجاري دولي |
| ATM9212 | GEUT0064230 | 6632 PERSONAS77 | البنك الأهلي المصري | القاهرة | التجمع الخامس | Point 90 Mall |

**احفظ الملف باسم:** `atms-data.xlsx` في المجلد `prisma/`

#### 2️⃣ **تثبيت المكتبات (إذا لم تكن مثبتة)**

```bash
npm install xlsx
```

#### 3️⃣ **تشغيل الاستيراد**

```bash
npm run db:import-excel
```

#### 4️⃣ **النتائج**

سترى في Terminal:

```bash
📖 قراءة ملف Excel...
📊 تم قراءة 150 صف من Excel

⚙️ بدء معالجة وإضافة الماكينات...

✅ 1. تمت إضافة: ATM9333
✅ 2. تمت إضافة: ATM9212
...

============================================================
📊 النتيجة النهائية:
============================================================
✅ تم إضافة بنجاح: 150 ماكينة
❌ فشل: 0 ماكينة
⚠️  تم تخطي: 0 صف
📝 الإجمالي: 150 صف
============================================================
```

---

## 📋 تنسيقات الملفات المدعومة

### ✅ **الصيغ المقبولة:**
- `.xlsx` - Excel 2007+
- `.xls` - Excel القديم
- `.csv` - Comma Separated Values (UTF-8)

### ⚠️ **ملاحظات مهمة:**
1. **الصف الأول يجب أن يحتوي على أسماء الأعمدة**
2. **يمكن استخدام أسماء عربية أو إنجليزية للأعمدة**
3. **الأعمدة الإجبارية:**
   - لماكينات ATM: `ATM Code`
   - للمندوبين: `Name`, `Username`
   - للبنوك: `Name`
   - للمحافظات: `Name`

---

## 🎯 أمثلة على أسماء الأعمدة المدعومة

### لماكينات ATM:

| العربي | الإنجليزي البديل |
|--------|-------------------|
| كود الماكينة | `ATM Code`, `atmCode`, `code` |
| السريال | `Serial`, `atmSerial`, `serial_number` |
| الموديل | `Model`, `atmModel`, `model_type` |
| البنك | `Bank`, `bankName`, `bank_name` |
| المحافظة | `Governorate`, `governorate_name` |
| المدينة | `City`, `city_name` |
| العنوان | `Address`, `location` |

---

## 🔄 التحديث التلقائي

**ميزة ذكية:** 
- إذا كان الكود (مثل `ATM Code`) موجوداً في قاعدة البيانات، **سيتم تحديث البيانات** بدلاً من إضافة سجل جديد
- هذا يعني يمكنك استيراد نفس الملف مرات عديدة دون قلق!

---

## 🆘 حل المشاكل الشائعة

### ❌ المشكلة: "Cannot find module 'xlsx'"
**الحل:**
```bash
npm install xlsx
```

### ❌ المشكلة: "ملف غير موجود"
**الحل:**
- تأكد من وضع الملف في المجلد الصحيح: `prisma/atms-data.xlsx`
- أو غيّر المسار في `prisma/import-atms-from-excel.ts`

### ❌ المشكلة: "عمود مطلوب غير موجود"
**الحل:**
- تأكد من وجود جميع الأعمدة الإجبارية
- تأكد من أن أسماء الأعمدة مكتوبة بشكل صحيح (مع أو بدون مسافات)

### ❌ المشكلة: "فشل استيراد السجل"
**الحل:**
- تحقق من تفاصيل الخطأ في التقرير
- تأكد من صحة البيانات (مثل: البنك موجود، المحافظة صحيحة)

---

## 📊 مثال كامل: استيراد 1000 ماكينة ATM

### الخطوة 1: تحضير ملف Excel

أنشئ ملف `atms-data.xlsx` بهذا الشكل:

```
| ATM Code | Serial      | Model            | Bank                 | Governorate | City          | Address              |
|----------|-------------|------------------|----------------------|-------------|---------------|----------------------|
| ATM001   | SER001      | NCR 6632        | البنك الأهلي المصري  | القاهرة     | مدينة نصر     | شارع مصطفى النحاس    |
| ATM002   | SER002      | Diebold 9900    | بنك مصر              | الجيزة      | الدقي         | شارع التحرير         |
| ATM003   | SER003      | Wincor 2050     | البنك التجاري الدولي | الإسكندرية | سموحة         | شارع فوزي معاذ       |
... (997 سطر إضافي)
```

### الخطوة 2: رفع الملف

**عبر الواجهة:**
1. افتح `http://localhost:9002/import-data`
2. اختر "ماكينات ATM"
3. ارفع الملف `atms-data.xlsx`
4. اضغط "استيراد"

**أو عبر Terminal:**
```bash
# ضع الملف في prisma/atms-data.xlsx
npm run db:import-excel
```

### الخطوة 3: انتظر النتائج

سيتم معالجة جميع السجلات وستحصل على تقرير مفصل.

---

## 🎨 نصائح احترافية

### ✅ **للحصول على أفضل النتائج:**

1. **استخدم القوالب المتوفرة** - حمّل القالب من الصفحة واملأه
2. **تحقق من البيانات قبل الاستيراد** - تأكد من صحة أسماء البنوك والمحافظات
3. **ابدأ بعينة صغيرة** - جرّب استيراد 10 سجلات أولاً للتأكد من التنسيق
4. **احتفظ بنسخة احتياطية** - احفظ الملف الأصلي قبل الاستيراد
5. **راجع التقرير** - اقرأ تفاصيل الأخطاء لإصلاح المشاكل

---

## 🚀 الخطوة التالية

بعد نجاح الاستيراد:

1. ✅ **تحقق من البيانات:** افتح صفحة **بيانات الصرافات** للتأكد
2. ✅ **راجع الإحصائيات:** افتح **لوحة التحكم** لرؤية العدد الإجمالي
3. ✅ **ابدأ العمل:** يمكنك الآن إنشاء خطط عمل وتعيين المندوبين!

---

## 📞 هل تحتاج مساعدة؟

إذا واجهت أي مشاكل:
1. تحقق من ملف الوثائق: `IMPORT_ATMS_FROM_EXCEL.md`
2. راجع سجل الأخطاء في التقرير
3. تأكد من تنسيق الملف صحيح

---

## 🎉 مثال سريع - جرّب الآن!

**افتح:** http://localhost:9002/import-data

**اختر:** ماكينات ATM

**حمّل القالب** → **املأه** → **ارفعه** → **شاهد السحر! ✨**


