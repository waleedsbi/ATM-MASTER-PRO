# 📊 استيراد ماكينات ATM من ملف Excel

## 🎯 الخطوات البسيطة

### الخطوة 1: تثبيت المكتبات المطلوبة

```bash
npm install xlsx
npm install -D @types/node
```

---

### الخطوة 2: تحضير ملف Excel

#### أ) تنسيق ملف Excel

يجب أن يكون ملف Excel بهذا التنسيق (الصف الأول يحتوي على أسماء الأعمدة):

| ATM Code | Serial | Model | Bank | Governorate | City | Address |
|----------|--------|-------|------|-------------|------|---------|
| ATM9333 | GEUT0064262 | 6632 PERSONAS77 | البنك الأهلي المصري | القاهرة | القاهرة الجديدة | فرع بنك تجاري دولي |
| ATM9212 | GEUT0064230 | 6632 PERSONAS77 | البنك الأهلي المصري | القاهرة | التجمع الخامس | Point 90 Mall |

**أسماء الأعمدة المدعومة** (يمكن استخدام أي منها):
- **ATM Code** أو `atmCode` أو `كود الماكينة` أو `رقم الماكينة`
- **Serial** أو `atmSerial` أو `السريال` أو `الرقم التسلسلي`
- **Model** أو `atmModel` أو `الموديل` أو `النوع`
- **Bank** أو `bankName` أو `البنك` أو `اسم البنك`
- **Governorate** أو `governorate` أو `المحافظة`
- **City** أو `city` أو `المدينة`
- **Address** أو `address` أو `العنوان`

#### ب) حفظ الملف

1. احفظ ملف Excel باسم **`atms-data.xlsx`**
2. ضع الملف في المجلد: `G:\ATM Master Pro\V1\prisma\`

المسار الكامل يجب أن يكون:
```
G:\ATM Master Pro\V1\prisma\atms-data.xlsx
```

---

### الخطوة 3: تشغيل الاستيراد

في Terminal، شغّل:

```bash
npm run db:import-excel
```

---

## 📋 مثال على شكل ملف Excel

يمكنك إنشاء ملف Excel بهذا الشكل:

### Sheet 1: ATMs

```
| ATM Code  | Serial       | Model              | Bank                  | Governorate | City            | Address                    |
|-----------|--------------|--------------------|-----------------------|-------------|-----------------|----------------------------|
| ATM9333   | GEUT0064262  | 6632 PERSONAS77   | البنك الأهلي المصري   | القاهرة     | القاهرة الجديدة  | فرع بنك تجاري دولي - مول   |
| ATM9212   | GEUT0064230  | 6632 PERSONAS77   | البنك الأهلي المصري   | القاهرة     | التجمع الخامس    | Point 90 Mall              |
| ATM9213   | GEUT0064231  | 6632 PERSONAS77   | البنك الأهلي المصري   | القاهرة     | التجمع الخامس    | STYLISH                    |
```

---

## 🎬 ما الذي سيحدث؟

عند تشغيل الأمر، سترى:

```bash
📖 قراءة ملف Excel...
📊 تم قراءة 150 صف من Excel

🔍 عينة من البيانات:
{ 'ATM Code': 'ATM9333', Serial: 'GEUT0064262', ... }

⚙️ بدء معالجة وإضافة الماكينات...

✅ 1. تمت إضافة: ATM9333 - فرع بنك تجاري دولي - مول
✅ 2. تمت إضافة: ATM9212 - Point 90 Mall
✅ 3. تمت إضافة: ATM9213 - STYLISH
...

============================================================
📊 النتيجة النهائية:
============================================================
✅ تم إضافة بنجاح: 150 ماكينة
❌ فشل: 0 ماكينة
⚠️  تم تخطي: 0 صف
📝 الإجمالي: 150 صف
============================================================
```

---

## 🔄 خيارات إضافية

### إذا كان الملف في مكان آخر

يمكنك تعديل ملف `prisma/import-atms-from-excel.ts` في السطر:

```typescript
const excelFilePath = path.join(process.cwd(), 'prisma', 'atms-data.xlsx');
```

غيّره إلى:
```typescript
const excelFilePath = 'C:\\المسار\\الخاص\\بك\\atms.xlsx';
```

---

## ⚠️ ملاحظات هامة

1. ✅ **الملف يجب أن يكون بصيغة `.xlsx`** (Excel 2007+)
2. ✅ **الصف الأول يجب أن يحتوي على أسماء الأعمدة**
3. ✅ **عمود ATM Code إجباري** - باقي الأعمدة اختيارية
4. ✅ إذا كان ATM Code موجود، **سيتم تحديث البيانات** بدلاً من إضافة صف جديد

---

## 🆘 حل المشاكل

### المشكلة: "ملف Excel غير موجود"
**الحل:** 
- تأكد من وجود الملف في `prisma/atms-data.xlsx`
- أو غيّر المسار في ملف `import-atms-from-excel.ts`

### المشكلة: "Cannot find module 'xlsx'"
**الحل:**
```bash
npm install xlsx
```

### المشكلة: "عمود غير موجود"
**الحل:**
- تأكد من أن أسماء الأعمدة صحيحة
- أو عدّل أسماء الأعمدة في ملف `import-atms-from-excel.ts`

---

## 📸 مثال على ملف Excel

يمكنك تحميل القالب من هنا وملؤه:
[رابط القالب - يمكن إنشاؤه]

أو استخدم الصورة التي أرسلتها وحوّلها إلى Excel.

---

## ✅ بعد الاستيراد

تحقق من نجاح الاستيراد:
1. افتح: http://localhost:9002/system-status
2. يجب أن ترى عدد الماكينات الجديد

---

**💡 نصيحة:** يمكنك تشغيل الاستيراد عدة مرات - إذا كان ATM Code موجود، سيتم تحديث البيانات فقط!

